<html><head></head><meta charset="utf-8" /><body><html><head><meta charset="UTF-8" /><title>Urbit / Posts</title><meta name="viewport" content="width=device-width , initial-scale=1" /><link href="/tilde.ico" rel="icon" /><link href="/css/base.css" rel="stylesheet" /><link href="/css/lists.css" rel="stylesheet" /><link href="/css/visibility.css" rel="stylesheet" /><link href="/css/borders.css" rel="stylesheet" /><link href="/css/colors.css" rel="stylesheet" /><link href="/css/inputs.css" rel="stylesheet" /><link href="/css/typography.css" rel="stylesheet" /><link href="/css/menu.css" rel="stylesheet" /><link href="/css/images.css" rel="stylesheet" /><link href="/css/flex.css" rel="stylesheet" /><script src="https://www.googletagmanager.com/gtag/js?id=UA-47054188-1"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-47054188-1');</script></head><body><nav class="bg-black pb-36 menu-hide overflow-y"><div class="container"><div class="row pt-10 mb-3"><div class="col-sm-1 menu-toggle"><img class="w-8 h-8" src="/assets/menu-close.svg" /></div><div class="col-sm-9 col-md-8 col-lg-4 col-sm-offset-2 col-md-offset-1 white"><div class="mb-6"><a href="/primer"><h1>Primer</h1></a><p> </p></div><div class="mb-6"><a href="/posts"><h1>Posts</h1></a><p> </p></div><div class="mb-6"><a href="/docs"><h1>Docs</h1></a><p> </p></div></div></div></div><footer class="container mb-36 white"><div class="row"><div class="col-sm-6 col-sm-offset-3 col-md-offset-2"><div><div class="mb-6"><h4 class="mb-1">Follow</h4><div><a class="text-mono" href="https://twitter.com/@urbit" target="_blank">twitter.com/@urbit</a></div><div><a class="text-mono" href="https://github.com/urbit" target="_blank">github.com/@urbit</a></div></div><div class="mb-6"><h4 class="mb-1">Contact</h4><div class="text-mono text-400">~zod</div><div><a class="text-mono" href="mailto:support@urbit.org">support@urbit.org</a></div></div><div class="mb-6"><h4 class="mb-1">Company</h4><div><a href="/privacy">Privacy Policy</a></div><div><a href="/tos">Terms of Service</a></div><div class="text-400"><a href="/bounty">Bug Bounty + Security</a></div></div></div></div></div></footer></nav><div class="container mt-10"><div class="row fixed"><div class="col-sm-12 menu-toggle"><img class="w-8 h-8" src="/assets/menu-open.svg" /></div><div class="col-sm-8 col-md-12 ml-1 mt-3 sm-2"><ul class="list-reset h-font"><a href="/posts"><li>All</li></a><a href="/posts/updates"><li>Updates</li></a><a href="/posts/essays"><li>Essays</li></a><a href="/posts/media"><li>Media</li></a></ul></div></div><div class="row pb-80"><div class="col-sm-9 col-md-8 col-sm-offset-3 col-md-offset-2"><div class="post col-sm-12"><div><h1 id="bootstrapping-urbit-from-ethereum-">Bootstrapping Urbit from Ethereum </h1><p><i>~2017.9.20</i> </p><p><b>TL;DR:</b> </p><p>We&#39;ve decided to launch Urbit&#39;s constitution as a system of Ethereum contracts. </p><p>We&#39;ll instantiate a land registry for Urbit address space; an ERC20 “spark” token which is burned to create a generic star; and a voting system for self-governance. We&#39;ll also create template contracts which galaxies can use to auction stars, and stars to distribute planets. </p><h2 id="a-bit-of-background-">A bit of background </h2><p>One thing we realized after the last sale was, &#39;oh hey, the network has been up for about a year.&#39; Not bad! It wasn&#39;t that long ago that we were rebooting the universe every few weeks. We still have plenty of work to do — but Urbit has matured to the point where public ownership of the network really should be cryptographically real. </p><p>But even when the servers stay up, Urbit is still a testnet and remains centralized in practice. We (Tlon) retain the ability to reset the network keys at any time. This just isn&#39;t very 2017. </p><p>In theory, Urbit doesn&#39;t need a blockchain, because real estate moves slowly. In digital real estate, as opposed to digital currency, a low-friction, zero-trust solution to the double-spend problem isn&#39;t an economic necessity. </p><p>In practice, though, we have a hard chicken-egg problem. In the current design, the key you use to secure your urbit is the same key that you use to sign your network packets. Abstractly, this is the right design -- you want one definition of who owns an identity. </p><p>But concretely, since Urbit keys are valuable, you don&#39;t want to put them in an operating system that isn&#39;t generally recognized as systematically secure. It&#39;s hard to achieve this status while you&#39;re a testnet. So the virtuous cycle never gets started. </p><p>Moving the Urbit land registry to Ethereum is an easy and obvious solution to this problem. If your urbit is owned by an offline Ethereum key, there&#39;s now a mature ecosystem for protecting this property. And its security doesn&#39;t depend on the security of Urbit. So, we realized, maybe Urbit actually does need a blockchain for its land registry. While the system matures, we can bootstrap off of Ethereum, without changing the design of the Urbit cryptosystem. </p><p>And best of all, you can get your Urbit star or planet entirely through the blockchain, without interacting with any centralized database or payment mechanism. So we&#39;re really living in 2017. </p><p>Sounds good, right? </p><p>It does sound good. Although, as usual, we care about making things that <b>work</b> above all else. So, rather than a &#39;announcing the Urbit token sale&#39; post, this is going to get fairly technical. We want to start the discussion about how this change is going to work, and how it&#39;s going to get implemented. We&#39;ll save the hype for later. </p><p>First, we&#39;ll walk through the costs and benefits of using Ethereum. Then, we&#39;ll refresh our memories on how the Urbit address space works, and finally we&#39;ll walk through some of the details of how we plan on implementing this. We&#39;ve thought quite thoroughly about these things, but public criticism is really important. </p><h2 id="weighing-the-choice-of-ethereum-">Weighing the choice of Ethereum </h2><p>Our engineering style is to build the whole stack, from axioms to UI, from custom, super-minimal parts. When these parts don&#39;t fit perfectly, we rewrite them until they do. With a few exceptions, such as crypto algorithms, Urbit doesn&#39;t reuse existing code or designs, depend on existing tools, or expect outside contributors to solve problems essential to a complete experience. </p><p>Instinctive minimalism is essential in a custom full stack. The best solution is always to not solve the problem. The natural engineering response to the pre-blockchain difficulty of solving Byzantine consensus agreement was: do we really need it? </p><h3 id="the-case-against-ethereum-">The case against Ethereum </h3><p>Since Urbit network address space is a land registry, not a currency, transactions are low-frequency. A low-frequency transaction system can succeed economically even if it has high friction. The double-spend problem, which consensus computing solves, becomes easy or at least tractable given high friction. </p><p>We reinvent the wheel if we have to, throw it away if we can. So depending on Ethereum goes against all Urbit&#39;s instincts. </p><p>Let&#39;s enumerate the problems, as critically as we can: </p><p>And Ethereum&#39;s user experience is notorious; its governance is suspect and unstable; its dilution rate is unconscionable; its dev environment is full of bugs and misfeatures; in short, it&#39;s a classic MVP. It has only one real goal: success. It seems to be doing pretty well with that. </p><p>We prefer <a href="https://blog.asmartbear.com/slc.html">SLC</a> to MVP. Urbit under construction is fun to play around in. But we certainly won&#39;t ask real users or real developers to set foot in Urbit until their experience is truly simple, lovable and complete. The original iPhone set the bar for this, and we&#39;ll get as close as we can. </p><h3 id="the-case-for-ethereum-">The case for Ethereum </h3><p>It&#39;s obvious that Urbit has a practical problem in deploying a self-hosted PKI. When does the testnet become a realnet? You wouldn&#39;t put real, valuable keys in your urbit, until you know the system is mature and secure. </p><p>But how does anyone know that Urbit is mature until more daring users have used it with real, valuable keys? But who wants to be the first person to hop into the box? </p><p>There is no clear way to bootstrap past the testnet phase. Except, well, reboot Urbit onto an existing blockchain, with a tested and reasonably-secure key-handling infrastructure, that can also validate the Urbit PKI rules. Then each user can decide on their own whether sensitive data is safe in their own urbit. </p><h2 id="an-urbit-refresher-">An Urbit refresher </h2><p>Maybe some people are here because they know what Ethereum is, but not so much Urbit. </p><p>For those of you not familiar, let&#39;s try to refresh your memories. </p><h3 id="what-urbit-is-">What Urbit is </h3><p>One simple way to think about Urbit is as a “personal blockchain.” Like a blockchain, Urbit is a deterministic virtual computer. Its semantics are defined by a frozen lifecycle function, which maps its event history to its current state. But, unlike a blockchain, an Urbit instance is a private computer for one user, not a public record for everyone. </p><p>Urbit&#39;s lifecycle function is a nano-interpreter called Nock. A typed functional language, Hoon, compiles itself to Nock. An event-driven OS, Arvo, is written in Hoon. Everything above Nock can upgrade itself over Urbit&#39;s own overlay packet network, Ames. Ames is live and stable with test keys. </p><p>Our Urbit interpreter runs on any Unix machine. The Urbit server is a single-level store -- both database and application engine. Every Urbit event is a transaction. Urbit is semantically frozen and cannot call out to Unix. </p><p>Your Urbit instance is your personal server. Your urbit should eventually contain and manage your whole digital life. You may compute at home or in the cloud, based on your security/privacy tradeoff, but Urbit&#39;s formal semantics makes ships trivial to migrate. You&#39;ll never be locked in to one computing provider. </p><h3 id="the-urbit-address-space-">The Urbit address space </h3><p>An Urbit address is called a “ship.” A ship is a network address, a cryptographic identity, a pronounceable name, and a permanent memory. A ship&#39;s name is just its numeric address, written in a syllabic base-256. </p><p>Smaller addresses mean shorter, more memorable ships. Ships are classified in a hierarchy: 8-bit “galaxies” (like <code>~dyl</code>), 16-bit “stars,” (<code>~ropdyl</code>), and 32-bit “planets” (<code>~ravmel-ropdyl</code>). Galaxies and stars are network infrastructure. Regular users have planets. The tight 32-bit address space makes names short enough to remember, and costly enough to deter Sybil attacks. </p><p>Planets are created by their prefix star; stars are created by their prefix galaxy; galaxies were created by the founders. Parents assist their children, providing essential services like peer-to-peer packet routing, but don&#39;t own or control them. The prefix is just an initial default -- a ship can switch to any parent that&#39;s willing to adopt it. </p><h2 id="summary-of-the-integration-model-">Summary of the integration model </h2><p>In the new integrated model, every planet, galaxy or star is owned by an Ethereum address. The secret that controls this address is the ship&#39;s “master key.” </p><p>The master key is not needed to operate the ship and should not be stored on it, at least not until Urbit is more mature. Master keys should be kept as “cold” as possible. They are only used to perform lifecycle operations on your ship, by signing Ethereum transactions which are sent to the Urbit constitution. </p><p>We&#39;ll fork an open-source Ethereum browser and add a custom UI for Urbit transactions. New users will acquire their urbits entirely on the blockchain. </p><p>The most basic Urbit transaction is starting a ship you own. To start your ship, you use Urbit to generate an Urbit keypair, and use Ethereum to register the Urbit public key (a 512-bit pair of Curve25519 for encryption and Ed25519 for signature) on the Ethereum blockchain. </p><p>For users who want to hold generic stars without starting or even selecting specific ships, we&#39;ll create a divisible “spark” (USP) ERC20 token. A spark is the right to create one star. Sparks are a convenience tool: they leverage the mature ERC20 infrastructure for holding and trading token utility rights. </p><p>Instead of launching stars directly, galaxies can cede their unlaunched stars to the Urbit constitution. The issuing galaxy receives one spark in exchange for this star. Any Ethereum address can redeem one spark in exchange for the right to start one star from the constitution&#39;s pool. </p><p>Once all the galaxies are created, Urbit is fully decentralized. We retain no ownership powers over the Urbit constitution. </p><p>The Urbit galaxies will mirror the state of the constitution, distribute its state and events within Urbit, and post any transactions created within Urbit. Generally an Urbit ship trusts its parent -- if not, it should find a new one fast. But a deeply paranoid ship can still listen to Ethereum directly. </p><h2 id="contract-designs-">Contract designs </h2><p>The Urbit constitution is four contracts: certificate storage, spark storage, election storage, and logic controller. </p><p>Following Ethereum best practice, we&#39;ll use separate storage and logic contracts. The logic contract is stateless, and can upgrade itself without replacing the storage contracts. </p><p>We&#39;ll walk through how we have designed these contracts in detail here. You can also view our in-progress source at the <a href="https://github.com/urbit/constitution"><code>urbit/constitution</code> GitHub repo</a>. </p><h3 id="certificate-storage-contract-">Certificate storage contract </h3><p>For every galaxy, star or planet, the certificate contract holds a current state: <code>%latent</code>, <code>%locked</code>, <code>%liquid</code> or <code>%living</code>. </p><p>The default/empty state is <code>%latent</code> (nothing has happened to this ship). The contract stores no data for a latent ship. </p><p>A <code>%locked</code> ship has an owner and an activation date. It cannot be activated until the given date. Until activated, the locked ship can&#39;t be transferred, vote, liquidate or launch children. </p><p>A <code>%liquid</code> ship is held by the Urbit constitution to be redeemed for a spark. It has no other state. </p><p>A <code>%living</code> ship is active. Its state: an Ethereum address which owns it; an Urbit public key; a revision number, which increments on any lifecycle operation; and (for planets and stars) both current and requested (for escaping) parent ships. </p><p>The certificate contract throws an event on every state change. </p><h3 id="spark-storage-contract-">Spark storage contract </h3><p>The spark contract is a divisible ERC20 token (you can&#39;t hold half a star, but you can hold half a spark). Only the logic contract can create and destroy tokens. </p><h3 id="governance-storage-contract-">Governance storage contract </h3><p>The governance contract records galaxies&#39; votes on governance proposals. </p><p>There are two kinds of proposals: concrete and abstract. A concrete proposal is the address of a new logic contract for the constitution. An abstract proposal is the hash of a document. </p><p>Voting is one-bit -- the default vote is “no” -- and irreversible. A 256-bit bitfield records the set of galaxies that have voted for each proposal. </p><p>Only active galaxies may vote. A counter records the number of active galaxies. A proposal passes if more than 50% of active galaxies support it. If the proposal is concrete, the old logic contract is terminated and the new one receives storage control. Abstract proposals have no further effects on the blockchain. </p><h3 id="logic-contract-">Logic contract </h3><p>The logic contract is stateless and supports the following ops: </p><h4 id="create-a-galaxy-">Create a galaxy </h4><p>What: move a galaxy from <code>%latent</code> to <code>%locked</code> state. </p><p>Who: the founders only. </p><p>Comments: this is the only founder-privileged operation. </p><h4 id="liquidate-a-star-">Liquidate a star </h4><p>What: move a specific star from <code>%latent</code> to <code>%liquid</code> state, granting one spark to the galaxy owner. </p><p>Who: owner of the active galaxy which is the star&#39;s prefix. </p><h4 id="claim-a-star-">Claim a star </h4><p>What: move a specific star from <code>%liquid</code> to <code>%locked</code> state, with the activation date set to the present, and the owner as claimer; remove one spark from the owner. </p><p>Who: any Ethereum address which owns a spark. </p><h4 id="launch-a-star-or-planet-">Launch a star or planet </h4><p>What: move a specific star or planet from <code>%latent</code> to <code>%locked</code> state, with the activation date set to the present, and set the Ethereum address which owns the ship. </p><p>Who: owner of the parent of the launched ship. </p><h4 id="start-a-ship-">Start a ship </h4><p>What: move a specific ship from <code>%locked</code> to <code>%living</code> state, setting its Urbit public key. </p><p>Who: owner of the locked ship. </p><h4 id="transfer-a-ship-">Transfer a ship </h4><p>What: change the owner of a <code>%living</code> ship, also resetting the Urbit public key. </p><p>Who: current owner of the ship. </p><h4 id="rekey-a-ship-">Rekey a ship </h4><p>What: in a living ship, change the Urbit public key, without changing the Ethereum address that owns the ship. </p><p>Who: owner of the ship. </p><h4 id="request-adoption-">Request adoption </h4><p>What: in a living ship, set the requested-parent field. </p><p>Who: owner of the ship. </p><h4 id="accept-adoption-">Accept adoption </h4><p>What: in a living ship, set the current parent to the requested parent, and clear the requested parent. </p><p>Who: owner of the requested parent. </p><h4 id="create-a-proposal-">Create a proposal </h4><p>What: create a proposal, which is either the hash of a document (abstract) or the address of a new logic contract (concrete). </p><p>Who: owner of any living galaxy. </p><h4 id="endorse-a-proposal-">Endorse a proposal </h4><p>What: register support for a proposal. If the proposal is concrete and this vote takes it over 50%, upgrade the contract. </p><p>Who: any galaxy who has not yet voted on this proposal. </p><h3 id="planet-sales-and-spark-auctions-">Planet sales and spark auctions </h3><p>We&#39;ll also write contracts that help galaxies and stars distribute their stars and planets. </p><h4 id="an-auction-contract-for-spark-sales-">An auction contract for spark sales </h4><p>The ERC20 spark token creates a liquid market in stars, or rather star precursors. But a galaxy liquidating sparks may not want to just sell a large block into this market, which may have weak depth, especially when the token is initially launched. </p><p>So we&#39;ll validate and deploy the Nick Johnson design for an <a href="https://www.reddit.com/r/ethereum/comments/6igsdq/a_proofofconcept_of_a_better_crowdsale_contract/">off-chain second-price auction</a> </p><p>To run an auction, the seller liquidates a block of stars, then transfers the spark tokens to a seller-owned copy of the auction contract. The Urbit constitution is not involved with the auction. </p><h4 id="a-distribution-contract-for-planet-sales-">A distribution contract for planet sales </h4><p>There is no generic token for planets. To start a planet, you need a star to launch it with your Ethereum address as the owner. </p><p>To distribute planets on the blockchain, a star instantiates a private copy of the planet sale contract. Since the star is the contract&#39;s owner, the contract can send launch operations to the Urbit constitution. </p><p>The star owner configures the planet sale contract with two parameters: the price in ether of a planet, and the number of planets available. </p><h2 id="okay--so-">Okay, so </h2><p>That was quite a lot of information! We&#39;ve created a fora thread <a href="https://urbit.org/fora/posts/~2017.9.20..22.56.04..47ce~">here</a> for discussion, and would be glad to hear your feedback. GitHub issues on the <a href="https://github.com/urbit/constitution">urbit/constitution repo</a> are also more than welcome. </p><p>There&#39;s a lot more to come on this front as our contracts get closer to getting live, and we begin migrating toward an on-chain Urbit PKI. </p></div></div></div></div></div><footer class="container mb-36"><div class="row"><div class="col-sm-8 col-sm-offset-3 col-lg-4 col-md-offset-2"><div id="mc_embed_signup"><h2 class="mb-2">Updates</h2><p>Every month we send an email with community events and what we&#39;re up to. </p><iframe name="nothing" style="display:none;"></iframe><form id="mc-embedded-subscribe-form" class="validate" action="https://urbit.us11.list-manage.com/subscribe/post?u=972a03db9e0c6c25bb58de8c8&amp;amp;id=be143888d2" method="post" name="mc-embedded-subscribe-form" target="nothing"><div class="input-group text-mono" id="mc_embed_signup_scroll"><div class="mc-field-group"><input class="required mb-2" type="email" name="EMAIL" id="mce-EMAIL" placeholder="your@email.com"></input></div><div id="mce-responses" class="clear"><div id="mce-error-response" class="response" style="display:none"></div><div id="mce-success-response" class="response" style="display:none"></div></div><div style="position: absolute; left: -5000px;"><input type="text" name="b_972a03db9e0c6c25bb58de8c8_be143888d2"></input></div><div class="clear"><button id="mc-embedded-subscribe" class="bg-black white h-font" type="submit" name="subscribe"><span class="text-500">Subscribe</span></button></div></div></form></div></div></div><div class="row"><div class="col-sm-6 col-sm-offset-3 col-md-offset-2"><div><div class="mb-6"><h4 class="mb-1">Follow</h4><div><a class="text-mono" href="https://twitter.com/@urbit" target="_blank">twitter.com/@urbit</a></div><div><a class="text-mono" href="https://github.com/urbit" target="_blank">github.com/@urbit</a></div></div><div class="mb-6"><h4 class="mb-1">Contact</h4><div class="text-mono text-400">~zod</div><div><a class="text-mono" href="mailto:support@urbit.org">support@urbit.org</a></div></div><div class="mb-6"><h4 class="mb-1">Company</h4><div><a href="/privacy">Privacy Policy</a></div><div><a href="/tos">Terms of Service</a></div><div class="text-400"><a href="/bounty">Bug Bounty + Security</a></div></div></div></div></div><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script src="/js/main.js"></script></footer></body></html></body></html>