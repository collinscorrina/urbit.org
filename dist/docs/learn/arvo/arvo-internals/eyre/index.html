<html><head></head><meta charset="utf-8" /><body><html><head><meta charset="UTF-8" /><title>Urbit / Docs</title><meta name="viewport" content="width=device-width , initial-scale=1" /><link href="/tilde.ico" rel="icon" /><link href="/css/base.css" rel="stylesheet" /><link href="/css/lists.css" rel="stylesheet" /><link href="/css/visibility.css" rel="stylesheet" /><link href="/css/borders.css" rel="stylesheet" /><link href="/css/colors.css" rel="stylesheet" /><link href="/css/inputs.css" rel="stylesheet" /><link href="/css/typography.css" rel="stylesheet" /><link href="/css/menu.css" rel="stylesheet" /><link href="/css/images.css" rel="stylesheet" /><link href="/css/flex.css" rel="stylesheet" /><script src="https://www.googletagmanager.com/gtag/js?id=UA-47054188-1"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-47054188-1');</script></head><body><nav class="bg-black pb-36 menu-hide overflow-y"><div class="container"><div class="row pt-10 mb-3"><div class="col-sm-1 menu-toggle"><img class="w-8 h-8" src="/assets/menu-close.svg" /></div><div class="col-sm-9 col-md-8 col-lg-4 col-sm-offset-2 col-md-offset-1 white"><div class="mb-6"><a href="/primer"><h1>Primer</h1></a><p> </p></div><div class="mb-6"><a href="/posts"><h1>Posts</h1></a><p> </p></div><div class="mb-6"><a href="/docs"><h1>Docs</h1></a><p> </p></div></div></div></div><footer class="container mb-36 white"><div class="row"><div class="col-sm-6 col-sm-offset-3 col-md-offset-2"><div><div class="mb-6"><h4 class="mb-1">Follow</h4><div><a class="text-mono" href="https://twitter.com/@urbit" target="_blank">twitter.com/@urbit</a></div><div><a class="text-mono" href="https://github.com/urbit" target="_blank">github.com/@urbit</a></div></div><div class="mb-6"><h4 class="mb-1">Contact</h4><div class="text-mono text-400">~zod</div><div><a class="text-mono" href="mailto:support@urbit.org">support@urbit.org</a></div></div><div class="mb-6"><h4 class="mb-1">Company</h4><div><a href="/privacy">Privacy Policy</a></div><div><a href="/tos">Terms of Service</a></div><div class="text-400"><a href="/bounty">Bug Bounty + Security</a></div></div></div></div></div></footer></nav><div id="sidebar-mobile" class="bg-gray-light sidebar-hide overflow-y"><div class="container"><div class="col-sm-10"><ol class="list-reset h-font mt-6"><li class="mb-4"><a class="h-font text-600" href="/docs/introduction">Introduction</a><ol><li><a class="h-font" href="/docs/introduction/technical-overview">Technical overview</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/introduction/source-code-overview">Source Code Overview</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/introduction/contributing">Contributing</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/introduction/arvo-vs-azimuth">Arvo vs. Azimuth</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/introduction/community-tutorials">Community Tutorials</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/introduction/galaxies-stars-and-planets">Galaxies, Stars, and Planets</a><ol class="list-reset h-font"></ol></li></ol></li><li class="mb-4"><a class="h-font text-600" href="/docs/getting-started">Getting Started</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/getting-started/azimuth">Using Bridge</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/getting-started/installing-urbit">Installing Urbit</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/getting-started/booting-a-ship">Booting a Ship</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/getting-started/creating-a-development-ship">Creating a Development Ship</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/getting-started/operating-a-star">Operating a Star</a><ol class="list-reset h-font"></ol></li></ol></li><li class="mb-4"><a class="h-font text-600" href="/docs/learn">Learn</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo">Arvo</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo/arvo-internals">Arvo Internals</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/ames">Ames</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/behn">Behn</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/admin">Admin and Operations</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/clay">Clay</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/dill">Dill</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/layout">Source layout</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/sail">Sail</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/messaging">Messaging</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/udon">Udon</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/eyre">Eyre</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/gall">Gall Apps</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/shell">Shell (Dojo)</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/ford">Ford</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/hall">Hall</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/filesystem">Introduction to the Filesystem</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/publishing">Web (Eyre)</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/generators">Generators</a></li></ol></li><li><a class="h-font" href="/docs/learn/arvo/hoon">Hoon</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo/hoon/getting-started">Getting Started</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/nouns">Nouns</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/the-subject-and-its-legs">The Subject and Its Legs</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/arms-and-cores">Arms and Cores</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/gates">Gates (Hoon Functions)</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/multi-gate-cores-and-doors">Multi-gate Cores and Doors</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/hoon-programs">Hoon Programs</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/hoon-syntax">Hoon Syntax</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/simple-one-gate-programs">Simple One-Gate Programs</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/atoms-auras-and-simple-cell-types">Atoms, Auras, and Simple Cell Types</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/type-checking-and-type-inference">Type Checking and Type Inference</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/structures-and-complex-types">Structures and Complex Types</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/cores">Cores</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/cores-again">Cores Again</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/lists">Standard Library: Lists</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/trees-sets-and-maps">Standard Library: Trees, Sets, and Maps</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/type-polymorphism">Type Polymorphism</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/examples">Examples</a></li></ol></li><li><a class="h-font" href="/docs/learn/arvo/nock">Nock</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo/nock/definition">Nock Definition</a></li><li><a class="h-font" href="/docs/learn/arvo/nock/explanation">Explanation</a></li><li><a class="h-font" href="/docs/learn/arvo/nock/example">Example</a></li><li><a class="h-font" href="/docs/learn/arvo/nock/implementations">Implementations</a></li></ol></li><li><a class="h-font" href="/docs/learn/arvo/vere">Vere</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo/vere/runtime">C Runtime System</a></li><li><a class="h-font" href="/docs/learn/arvo/vere/c">C in Urbit</a></li><li><a class="h-font" href="/docs/learn/arvo/vere/nouns">Land of Nouns</a></li><li><a class="h-font" href="/docs/learn/arvo/vere/api">API overview by prefix</a></li><li><a class="h-font" href="/docs/learn/arvo/vere/jetting">Writing Jets</a></li></ol></li><li><a class="h-font" href="/docs/learn/arvo/style">Hoon Style Guide</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/learn/arvo/workbook">Hoon Workbook</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo/workbook/list">List of Numbers</a></li><li><a class="h-font" href="/docs/learn/arvo/workbook/caesar">Caesar Cipher</a></li><li><a class="h-font" href="/docs/learn/arvo/workbook/recursion">Recursion</a></li><li><a class="h-font" href="/docs/learn/arvo/workbook/digits">Digits</a></li><li><a class="h-font" href="/docs/learn/arvo/workbook/eightball">Magic 8-Ball</a></li><li><a class="h-font" href="/docs/learn/arvo/workbook/traffic-light">Traffic Light</a></li><li><a class="h-font" href="/docs/learn/arvo/workbook/bomb">Bomb Defusing</a></li></ol></li></ol></li><li><a class="h-font" href="/docs/learn/azimuth">Azimuth</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/azimuth/blockchain">Why Urbit Uses a Blockchain</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/learn/azimuth/wallet">The Urbit HD Wallet</a><ol class="list-reset h-font"></ol></li></ol></li></ol></li><li class="mb-4"><a class="h-font text-600" href="/docs/reference">Reference</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/reference/hoon-expressions">Hoon Expressions</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/reference/hoon-expressions/rune">Runes</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/constants">Atoms and strings</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/dot">Nock . (&quot;dot&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/zap">Wild ! (&quot;zap&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/tis">Change Subject = (&quot;tis&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/wut">Conditionals ? (&quot;wut&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/bar">Cores | (&quot;bar&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/lus">Arms + (&quot;lus&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/col">Cells : (&quot;col&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/cen">Calls % (&quot;cen&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/ket">Casts ^ (&quot;ket&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/bus">Structures $ (&quot;bus&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/mic">Make ; (&quot;mic&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/sig">Hints ~ (&quot;sig&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/terminators">Terminators -- and ==</a></li></ol></li><li><a class="h-font" href="/docs/reference/hoon-expressions/limb">Limbs and Wings</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/reference/hoon-expressions/limb/limb">Limbs</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/limb/wing">Wings</a></li></ol></li><li><a class="h-font" href="/docs/reference/hoon-expressions/basic">Basic Types</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/hoon-expressions/advanced">Advanced Types</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/hoon-expressions/irregular">Irregular forms</a><ol class="list-reset h-font"></ol></li></ol></li><li><a class="h-font" href="/docs/reference/library">Standard library</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/reference/library/1a">1a: Basic Arithmetic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/1b">1b: Tree Addressing</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/1c">1c: Molds and Mold-Builders</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2a">2a: Unit Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2b">2b: List Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2c">2c: Bit Arithmetic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2d">2d: Bit Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2e">2e: Insecure Hashing</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2f">2f: Noun Ordering</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2g">2g: Unsigned Powers</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2h">2h: Set Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2i">2i: Map Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2j">2j: Jar and Jug Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2k">2k: Queue Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2l">2l: Container from Container</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2m">2m: Container from Noun</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2n">2n: Functional Hacks</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2o">2o: Normalizing Containers</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2p">2p: Serialization</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2q">2q: Molds and Mold-Builders</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3a">3a: Modular and Signed Ints</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3b">3b: Floating Point</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3c">3c: Urbit Time</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3d">3d: SHA Hash Family</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3e">3e: (Removed)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3f">3f: Scrambling</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3g">3g: Molds and Mold-Builders</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4a">4a: Exotic Bases</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4b">4b: Text Processing</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4c">4c: Tank Printer</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4d">4d: Parsing (Tracing)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4e">4e: Parsing (Combinators)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4f">4f: Parsing (Rule-Builders)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4g">4g: Parsing (Outside Caller)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4h">4h: Parsing (ASCII Glyphs)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4i">4i: Parsing (Useful Idioms)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4j">4j: Parsing (Bases and Base Digits)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4k">4k: Atom Printing</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4l">4l: Atom Parsing</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4m">4m: Formatting Functions</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4n">4n: Virtualization</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4o">4o: Molds</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5a">5a: Compiler Utilities</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5b">5b: Macro Expansion</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5c">5c: Compiler Backend &amp; Prettyprinter</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5d">5d: Parser</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5e">5e: Caching Compiler</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5f">5f: Molds and Mold-Builders</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5g">5g: profiling support</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/zuse">Zuse</a><ol class="list-reset h-font"></ol></li></ol></li><li><a class="h-font" href="/docs/reference/glossary">Glossary</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/cheat-sheet">Cheat sheet</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/troubleshooting">Hoon Errors</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/alphabetical-arms">Alphabetical Arms</a><ol class="list-reset h-font"></ol></li></ol></li></ol></div><div class="col-sm-1 sidebar-toggle fixed" style="top: 20px; right: 1em"><img class="w-8 h-8 dropdown-right" src="/assets/dropdown.svg" /></div></div></div><div class="container mt-10"><div class="sidebar-container row col-sm-3 fixed pb-30 h-100-md"><div class="col-sm-3 col-lg-6 menu-toggle"><img class="w-8 h-8" src="/assets/menu-open.svg" /></div><div class="col-sm-12 mt-7 sidebar-toggle md-hide"><img class="w-8 h-8 dropdown-left" src="/assets/dropdown.svg" /></div><div class="h-100 col-sm-8 col-md-11 overflow-y sm-hide"><ol class="list-reset h-font mt-6"><li class="mb-4"><a class="h-font text-600" href="/docs/introduction">Introduction</a><ol><li><a class="h-font" href="/docs/introduction/technical-overview">Technical overview</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/introduction/source-code-overview">Source Code Overview</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/introduction/contributing">Contributing</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/introduction/arvo-vs-azimuth">Arvo vs. Azimuth</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/introduction/community-tutorials">Community Tutorials</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/introduction/galaxies-stars-and-planets">Galaxies, Stars, and Planets</a><ol class="list-reset h-font"></ol></li></ol></li><li class="mb-4"><a class="h-font text-600" href="/docs/getting-started">Getting Started</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/getting-started/azimuth">Using Bridge</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/getting-started/installing-urbit">Installing Urbit</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/getting-started/booting-a-ship">Booting a Ship</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/getting-started/creating-a-development-ship">Creating a Development Ship</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/getting-started/operating-a-star">Operating a Star</a><ol class="list-reset h-font"></ol></li></ol></li><li class="mb-4"><a class="h-font text-600" href="/docs/learn">Learn</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo">Arvo</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo/arvo-internals">Arvo Internals</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/ames">Ames</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/behn">Behn</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/admin">Admin and Operations</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/clay">Clay</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/dill">Dill</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/layout">Source layout</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/sail">Sail</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/messaging">Messaging</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/udon">Udon</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/eyre">Eyre</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/gall">Gall Apps</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/shell">Shell (Dojo)</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/ford">Ford</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/hall">Hall</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/filesystem">Introduction to the Filesystem</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/publishing">Web (Eyre)</a></li><li><a class="h-font" href="/docs/learn/arvo/arvo-internals/generators">Generators</a></li></ol></li><li><a class="h-font" href="/docs/learn/arvo/hoon">Hoon</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo/hoon/getting-started">Getting Started</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/nouns">Nouns</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/the-subject-and-its-legs">The Subject and Its Legs</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/arms-and-cores">Arms and Cores</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/gates">Gates (Hoon Functions)</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/multi-gate-cores-and-doors">Multi-gate Cores and Doors</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/hoon-programs">Hoon Programs</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/hoon-syntax">Hoon Syntax</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/simple-one-gate-programs">Simple One-Gate Programs</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/atoms-auras-and-simple-cell-types">Atoms, Auras, and Simple Cell Types</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/type-checking-and-type-inference">Type Checking and Type Inference</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/structures-and-complex-types">Structures and Complex Types</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/cores">Cores</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/cores-again">Cores Again</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/lists">Standard Library: Lists</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/trees-sets-and-maps">Standard Library: Trees, Sets, and Maps</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/type-polymorphism">Type Polymorphism</a></li><li><a class="h-font" href="/docs/learn/arvo/hoon/examples">Examples</a></li></ol></li><li><a class="h-font" href="/docs/learn/arvo/nock">Nock</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo/nock/definition">Nock Definition</a></li><li><a class="h-font" href="/docs/learn/arvo/nock/explanation">Explanation</a></li><li><a class="h-font" href="/docs/learn/arvo/nock/example">Example</a></li><li><a class="h-font" href="/docs/learn/arvo/nock/implementations">Implementations</a></li></ol></li><li><a class="h-font" href="/docs/learn/arvo/vere">Vere</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo/vere/runtime">C Runtime System</a></li><li><a class="h-font" href="/docs/learn/arvo/vere/c">C in Urbit</a></li><li><a class="h-font" href="/docs/learn/arvo/vere/nouns">Land of Nouns</a></li><li><a class="h-font" href="/docs/learn/arvo/vere/api">API overview by prefix</a></li><li><a class="h-font" href="/docs/learn/arvo/vere/jetting">Writing Jets</a></li></ol></li><li><a class="h-font" href="/docs/learn/arvo/style">Hoon Style Guide</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/learn/arvo/workbook">Hoon Workbook</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/arvo/workbook/list">List of Numbers</a></li><li><a class="h-font" href="/docs/learn/arvo/workbook/caesar">Caesar Cipher</a></li><li><a class="h-font" href="/docs/learn/arvo/workbook/recursion">Recursion</a></li><li><a class="h-font" href="/docs/learn/arvo/workbook/digits">Digits</a></li><li><a class="h-font" href="/docs/learn/arvo/workbook/eightball">Magic 8-Ball</a></li><li><a class="h-font" href="/docs/learn/arvo/workbook/traffic-light">Traffic Light</a></li><li><a class="h-font" href="/docs/learn/arvo/workbook/bomb">Bomb Defusing</a></li></ol></li></ol></li><li><a class="h-font" href="/docs/learn/azimuth">Azimuth</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/learn/azimuth/blockchain">Why Urbit Uses a Blockchain</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/learn/azimuth/wallet">The Urbit HD Wallet</a><ol class="list-reset h-font"></ol></li></ol></li></ol></li><li class="mb-4"><a class="h-font text-600" href="/docs/reference">Reference</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/reference/hoon-expressions">Hoon Expressions</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/reference/hoon-expressions/rune">Runes</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/constants">Atoms and strings</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/dot">Nock . (&quot;dot&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/zap">Wild ! (&quot;zap&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/tis">Change Subject = (&quot;tis&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/wut">Conditionals ? (&quot;wut&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/bar">Cores | (&quot;bar&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/lus">Arms + (&quot;lus&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/col">Cells : (&quot;col&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/cen">Calls % (&quot;cen&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/ket">Casts ^ (&quot;ket&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/bus">Structures $ (&quot;bus&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/mic">Make ; (&quot;mic&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/sig">Hints ~ (&quot;sig&quot;)</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/rune/terminators">Terminators -- and ==</a></li></ol></li><li><a class="h-font" href="/docs/reference/hoon-expressions/limb">Limbs and Wings</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/reference/hoon-expressions/limb/limb">Limbs</a></li><li><a class="h-font" href="/docs/reference/hoon-expressions/limb/wing">Wings</a></li></ol></li><li><a class="h-font" href="/docs/reference/hoon-expressions/basic">Basic Types</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/hoon-expressions/advanced">Advanced Types</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/hoon-expressions/irregular">Irregular forms</a><ol class="list-reset h-font"></ol></li></ol></li><li><a class="h-font" href="/docs/reference/library">Standard library</a><ol class="list-reset h-font"><li><a class="h-font" href="/docs/reference/library/1a">1a: Basic Arithmetic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/1b">1b: Tree Addressing</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/1c">1c: Molds and Mold-Builders</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2a">2a: Unit Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2b">2b: List Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2c">2c: Bit Arithmetic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2d">2d: Bit Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2e">2e: Insecure Hashing</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2f">2f: Noun Ordering</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2g">2g: Unsigned Powers</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2h">2h: Set Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2i">2i: Map Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2j">2j: Jar and Jug Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2k">2k: Queue Logic</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2l">2l: Container from Container</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2m">2m: Container from Noun</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2n">2n: Functional Hacks</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2o">2o: Normalizing Containers</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2p">2p: Serialization</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/2q">2q: Molds and Mold-Builders</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3a">3a: Modular and Signed Ints</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3b">3b: Floating Point</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3c">3c: Urbit Time</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3d">3d: SHA Hash Family</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3e">3e: (Removed)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3f">3f: Scrambling</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/3g">3g: Molds and Mold-Builders</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4a">4a: Exotic Bases</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4b">4b: Text Processing</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4c">4c: Tank Printer</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4d">4d: Parsing (Tracing)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4e">4e: Parsing (Combinators)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4f">4f: Parsing (Rule-Builders)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4g">4g: Parsing (Outside Caller)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4h">4h: Parsing (ASCII Glyphs)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4i">4i: Parsing (Useful Idioms)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4j">4j: Parsing (Bases and Base Digits)</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4k">4k: Atom Printing</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4l">4l: Atom Parsing</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4m">4m: Formatting Functions</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4n">4n: Virtualization</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/4o">4o: Molds</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5a">5a: Compiler Utilities</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5b">5b: Macro Expansion</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5c">5c: Compiler Backend &amp; Prettyprinter</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5d">5d: Parser</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5e">5e: Caching Compiler</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5f">5f: Molds and Mold-Builders</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/5g">5g: profiling support</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/library/zuse">Zuse</a><ol class="list-reset h-font"></ol></li></ol></li><li><a class="h-font" href="/docs/reference/glossary">Glossary</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/cheat-sheet">Cheat sheet</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/troubleshooting">Hoon Errors</a><ol class="list-reset h-font"></ol></li><li><a class="h-font" href="/docs/reference/alphabetical-arms">Alphabetical Arms</a><ol class="list-reset h-font"></ol></li></ol></li></ol></div></div><div class="row pb-80"><div class="col-sm-9 col-md-8 col-sm-offset-2 col-md-offset-3 docs"><div><div><h1 id="eyre-">Eyre </h1><p>Our http server. </p><p>Unix sends http messages to <code>%eyre</code>, and <code>%eyre</code> produces http messages in response. In general, apps and vanes do not call <code>%eyre</code>; rather, <code>%eyre</code> calls apps and vanes. <code>%eyre</code> uses <code>%ford</code> and <code>%gall</code> to functionally publish pages and facilitate communication with apps. </p><p><code>%eyre</code> primarily parses web requests and handles them in a variety of ways, depending on the control string. Nearly all of these are essentially stateless, like functional publishing with <code>%ford</code>. Additionally, there&#39;s a fairly significant component that handles <code>%gall</code> messaging and subscriptions, which must be stateful. </p><h2><div id="reference">Reference</div></h2><h3 id="state-">State </h3><p>Stored </p><ul><li><p><code>++bolo</code> </p></li><li><p><code>++cyst</code> </p></li><li><p><code>++stem</code> </p></li></ul><p>Runtime </p><ul><li><p><code>perk</code> </p><ol><li><p><code>perk-auth</code> </p></li></ol></li><li><p><code>pest</code> </p></li><li><p><code>even</code> </p></li></ul><h3 id="cores-">Cores </h3><ul><li><p><code>++handle</code> </p><ol><li><p><code>++parse</code> </p><ul><li><p><code>++as...</code> </p></li></ul></li></ol></li><li><p><code>++ya</code> </p></li><li><p><code>++ix</code> </p></li></ul><h2><div id="commentary">Commentary</div></h2><p>Let us follow the loading of a simple cli app, as it bounces from browser to server to browser and back. </p><h3 id="initial-request--a-id----init------">Initial request ;a(id “init”); </h3><p>An http request for <code>http://sampel-sipnym.urbit.org/cli</code> will be <a href="dns">redirected</a> to the <code>%eyre</code> on ~sampel-sipnym, and come in as a <code>%this</code> kiss. </p><p>From arvo, requests enter <code>++call</code>, which after some type reification are passed along to <code>++apex:ye</code>. In the case of a <code>%this</code> kiss, its components are parsed(see <code>++zest:epur</code>, <code>++eat-headers</code>) and handed off to <code>++handle</code>, wrapped in <code>++emule</code> to produce a <code>++fail</code> page in case of error. <code>++apex:handle</code> will <code>++process</code> the request to a <code>pest</code> or a <code>++done</code> core, and in the former case <code>++resolve</code> the pest into an outgoing card. </p><p>XX it also seems to affect the current ship, test that serving ship name is consistently correct </p><p>The pest is produced by <code>++process</code>, which will first further <code>++parse</code> the request, and if this does not make the response immediately obvious, <code>++process-parsed</code> the resulting <code>perk</code>. </p><p><code>++parse</code> produces the <code>perk</code>, by attempting to interpret the <code>pork</code>(url path) <a href="#mage"><code>++as-magic-filename</code></a>, <code>++as-beam</code>, and <code>++as-aux-request</code>. In this case, <code>/cli</code> is parsed by the second case as a <code>%beam</code> query to <code>/=cli=</code>: a path which starts with a valid ship name is expected to be a full clay(well, ford) path, and one starting with a term implies the current serving ship and a case of <code>0</code>, the current revision. </p><p>XX spur: when the desks are merged, <code>/cli</code> shall point to <code>/=main=/pub/cli</code> </p><p>The parsed <code>perk</code> generates a <code>%f %boil</code> note, <code>mark</code>ed as its extension(here defaulting to <code>%urb</code>) and <code>wire</code>d with <code>~</code> to return unaltered to the client. It goes on to <code>++resolve</code> by being passed to <code>++ford-get-beam</code>, which translates the perk it into a <code>%boil</code> <code>++ford-req</code>, adding an <code>++fcgi</code> path-segment containing query string and <code>++fcgi-cred:for-client</code> auth information. </p><p><code>%ford</code>s translation of <code>/=cli=/hymn/hook</code> to a self-refreshing <code>%urb</code> html page <a href="/docs/learn/arvo/arvo-internals/ford#commentary">deserves its own commentary</a>, but we resume in <code>%eyre</code> when the <code>%made</code> sign arrives in <code>++take</code>, and soon after <code>++axon:ye</code>. There the <code>wire</code>, or rather the <code>whir</code> it has been verified to be, determines that the response should be served immediately. However, as the mark is not <code>%mime</code>, another trip to <code>%ford</code> is required to encode it, on the same wire; afterwards, the value of the <code>%mime</code> cage is verified to be of the correct type, and finally delivered back up the requesting duct as a successful <code>%thou</code> HTTP response. </p><p>XX <code>%cast %mime</code> used to be in ford-get-beam, is there a reason it was removed? </p><h2 id="back-into-the-breach--or--auxilary-requests-">Back into the breach, or: auxilary requests </h2><p>Now, it was mentioned that this result is self-refreshing: the <code>%urb</code> translation door injects a <code>;script@&quot;/~/on/{deps}.js&quot;</code> into every page, <code>deps</code> is a ford-readable hash of the set of resources that page construction depended on. </p><p>This triggers another <code>%this</code> request. Its handling is identical to that of <code>/cli</code> up until <code>++parse</code>, where it is seen not <code>++as-beam</code> but <code>++as-aux-request</code>(auxillary requests starting with <code>/~/</code> or <code>/~~/</code>). <code>/on/[hash]</code> is a long-<code>%poll</code>, which <code>++process-parsed</code>, for a <code>.js</code> mark, answers with a direct <code>%js</code>. Its contents are the static <code>++poll:js</code>, which initiates the long-polling loop, run against an injected <code>urb.js</code> of <code>{poll:[hash]}</code>. </p><p>A <code>%js</code> <code>pest</code> is <code>resolve</code>d as a <code>text/javascript</code> success <code>%this</code>. </p><p>When <code>poll.js</code> is received by the client, it opens an <code>XMLHttpRequest</code> for <code>/~/on/{window.urb.poll}.json</code>, bringing us back to <code>%poll:process</code>. </p><p>In the case of a non-<code>%js</code> <code>/~/on/</code>, <code>%poll:process-parsed</code> turns into a <code>++new-dependency</code>, which stores the listening duct, and <code>pass-note</code>s a <code>%wasp</code> with the deps-hash back to <code>%ford</code> whence it came. While this occured, the page has loaded. </p><p>Some indeterminate amount of time afterwards, with dropped <code>/~/on/{...}.json</code>s being retried upon expiring and also being stored, a <code>%news</code> sign arrives in <code>++axon</code>, and the hash in question is retrieved from the wire, and the listening long-polls retrieved by the hash. Each receives a 205 “Reload parent view” HTTP response, which <code>poll.js</code> dutifully executes, and a fixed typo of markdown is rendered. </p><h2 id="authentication-">Authentication </h2><p>Now, while this accurately reflects the presentation of e.g. a markdown file, <code>/cli</code> is an application front-end, and one that permits only owner access. Its second script is <code>@&quot;/~~/~/at/main/lib/urb.js&quot;</code>, semantically equivalent to <code>/~/as/own/~/at/main/lib/urb.js</code>, and handled as follows. </p><p>In <code>++as-aux-request</code>, <code>%as %own</code> becomes <code>%auth %get our</code> perk, which <code>++process</code> passes to <code>++process-parsed</code> passes to <code>++process-auth</code>. There, a <code>yac</code> “ya” core is built <code>++for-client</code>: a <code>++cookie-prefix</code>, which is just the serving ship name, is used to get a <code>++session-from-cookies</code>, here nil as the client has no cookie set. In lieu of a cookie, a <code>++new-ya</code> is constructed, with a random token <code>hole</code> and a <code>++new-cyst</code> which fills out <code>cyst</code> session state from request data. </p><p>Returning to <code>++process-auth</code>, <code>%get</code> checks if the yac is authenticated with the requested credentials(<code>anon</code> requests are always granted), which for the fresh new <code>cyst</code> is not the case (more on success <a href="#auth-ok">later</a>). Unless authentiacting as a <a href="#xeno">foreign ship</a>, the only thing left is to <code>++show-login-page</code>, which detects that the requested resource is not <code>%html</code>, and produces a <code>%red</code> pest. For <code>%js</code>, <code>%red</code>irections <code>++resolve</code> to <code>++auth-redir:js</code>, a line of javascript which prepends <code>/~~</code> to the url path. </p><p>The owner-authenticated main page request similarly ends in <code>++show-login-page</code>, which for the empty session is an <code>[%htme ++login-page:xml]</code>, <code>resolve</code>d to <code>++give-html</code> with a 401 “unathorized”. </p><p>The login page shows a simple prompt, and requests <code>/~/at/auth.js</code> to handle the submission. And so we are, once again, attempting to divine if what we&#39;re doing makes sense <code>++as-aux-request</code>. </p><p>To understand <code>/~/at</code>, there will first be a brief diversion to <code>~/auth.json</code>. <code>auth.json</code>, perk <code>[%auth %json]</code>, in <code>++process-auth</code> serves <code>++stat-json:ya</code>, containing such information as the serving ship, which identities are associated with this session, and <code>oryx</code>, a CSRF token. An oryx must be present on all stateful requests, in this case executing a log in. It also saves the new/old session using <code>abet</code>. </p><p>XX explain <code>ixor</code> here and not <a href="#ixor">later</a>? </p><p><code>/~/at</code> is an alternate interface, which injects <code>auth.json</code> data into the requested file. <code>/~/at/auth.js</code>, then, is a request for the built-in <code>auth:js</code> (parsed to and processed from an <code>[%auth %js ~]</code> perk), with session data added as <code>window.urb</code>. And indeed, <code></code>[<code>%js /~/at/auth]</code><code> is parsed to </code><code>[%auth at [</code>%js /auth]<code></code>, which in <code>++process-auth</code> is re-<code>process</code>ed to <code>[%js ++auth:js]</code>, which is <code>++resolve</code>d after an <code>++add-json</code> of the relevant data. The yac cookies are also passed to <code>resolve</code>, which <code>++add-cookies</code> injects into the <code>httr</code>. </p><p>It is at this point that there is first occasion for user input, namely the password. </p><p>The <code>auth:js</code> script sends a <code>PUT</code> request, also to <code>/~/auth.json</code>. In <code>parse</code>, the first nontrivial <code>++check-oryx</code> occurs, <code>++grab-body</code> the request oryx and ensuring it is recorded for the session. The request parsed with <code>++need-body</code> to a <code>[%auth %try {password}]</code> perk. <code>%get:process-auth</code> checks it against <code>++load-secret</code>, upon success updates the session with <code>++logon:ya</code>, and serves a fresh <code>auth.json</code> which reflects the changed <code>user</code>. Upon receiving this, the page is refreshed to retry the original request. </p><h3 id="post-authentication--app-communication---a-id----auth-ok------">Post-authentication: app communication. &lt;a id=“auth-ok”/&gt; </h3><p>Upon refresh, <code>/~~/cli</code> brings us for the third time to <code>%get:process-auth</code>, but this time the cookie is set, and the <code>yac</code> fetched contains the serving ship as authenticated. The <code>++handle</code> sample is updated to reflect the requesting ship, and the <code>process</code> continues for the rest of the pork, once again serving the ford page. </p><p>The <code>/~/on/[deps].json</code> poll starts anew, and <code>/~~/~/at/main/lib/urb.js</code> we now know to serve the window.urb necessary to make requests, and the <code>urb.js</code> standard library which extends it with a number of wrappers to them and other useful functions. </p><p>One of those functions is <code>urb.bind</code>, which is used to subscribe to application data. Userspace javascript sets <code>urb.appl</code> to <code>/tic</code>, and binds <code>lines</code> to a <code>;pre;</code> text display, using a callback. </p><p>This triggers a <code>PUT</code> to <code>/~/is/{ixor}/cli/lines.json</code>, where <code>ixor</code> is a hash of <code>oryx</code> that identifies the connection. <code>++as-aux-request</code>, an <code>%is</code> is a <code>%subs</code> subscription update update, which for <code>%put</code> forwards to <code>++add-subs:ix</code>, the ix core fetched <code>++for-view</code> by hashing the request <code>++oryx-to-ixor</code>. </p><p>&lt;a id=“ixor”/&gt; A view has all the state associated with a client that must be remembered between events. In this case, this is what app/path the request duct is associated with; but mainly, <code>++add-subs:ix</code> will <code>pass-note</code> to <code>%gall</code> so it <code>%show</code>s the data on the path, current and future. </p><p>This will immediately(assuming the ship is local) result in a <code>%nice</code> by the <code>/cli</code> app, returning <code>{ok:true}</code> <code>++nice-json</code> to <code>urb.bind</code>&#39;s second callback as <code>{ok:true}</code>. The initial <code>%rush</code> results also arrive, and in <code>++axon</code> are converted to json using <code>++back</code>(ford <code>%cast</code> wrapper), and when <code>%made</code> get passed to <code>++get-rush:ix</code>. There the source application/path are decoded by duct, and then the full event goes to <code>++get-even</code>; <code>++add-even</code> inserts it to the queue, and as there is no long poll it simply stays there. </p><p>Upon receipt, the client realizes the long-poll isn&#39;t actually running, so that is started using <code>urb.poll</code>. At <code>/~/of/{ixor}</code>, perk <code>[%view ixor ~ {sequence-number}]</code>, it is <code>process</code>ed by <code>++poll:ix</code> (the cyst is retrieved by <code>++ire-ix</code> form global state, using the perk <code>ixor</code>): the sequence number is in the past, so the previously received <code>%rush</code> is <code>++give-even</code>. After deleting the previous message in the queue and invoking <code>++pass-took</code> to signal <code>%gall</code> of this occurrence, the data is annotated with the source app+path <code>++subs-to-json</code>, and returned to the polling duct. </p><p>On the client, the user callback receives the <code>/cli</code> history, and displays it on the page. The <code>/~/of</code> long poll is continued, this time reaching <code>++poll:ix</code> with the “pending” sequence number, and being stored in the <code>cyst</code> for its troubles. </p><p>Its next update proceeds idenitcally, but first it must be triggered, which happens when the user enters “(add 2 2)n”, firing an <code>urb.send</code> from the event handler. This sends a <code>POST</code> request to <code>/~/to/cli/json.json</code>, perk <code>%mess</code>, <code>++process</code>ed to a <code>%g %mess</code>. Were the mark not <code>%json</code>, a <code>%ford</code> conversion would occur first, and <code>%made:axon</code> would send the gall message proper. In either case, eventually a <code>%mean</code> or <code>%nice</code> arrives, is encoded as json, and sent to the client callback. </p><h2 id="a-path-not-taken--magic-filenames--a-id----mage------">A path not taken: magic filenames &lt;a id=“mage”/&gt; </h2><p>The <code>/robots.txt</code> and <code>/favicon.(ico|png)</code> files are static, and served immediately when caught by a <code>++parse</code>. </p><p>XX index.html? </p><h2 id="a-path-not-taken--foreign-auth--a-id----xeno------">A path not taken: foreign auth &lt;a id=“xeno”/&gt; </h2><p>While this example details a login <code>/~/as/own</code>, it is possible to be authenticated as any ship on the network. A request for such seen in <code>%get:process-auth</code> is passed to <code>++foreign-auth:ya</code>, which sends an <code>%ames /lon</code> message to the ship in question. The foreign ship stores the inquiry, calculates(the local) <code>++our-host</code> and responds with a <code>/hat</code>, containing the redirection host, which is stored by <code>++foreign-hat</code>; it is later used to send the client to a <code>/~/am</code> url on the foreign client, which acts as a normal login page but later sends the client back. XX expand, basically the status quo is you&#39;re logged in and <code>/~/as/foo</code> is ignored, just setting your <code>urb.user</code> XX </p><h3 id="a-path-not-taken--deauthentication-">A path not taken: deauthentication </h3><p><code>/~/away</code>, perk <code>[%away ~]</code>, produces a static <code>++logout-page:xml</code>, which also uses <code>/~/at/auth.js</code>, to send a <code>DELETE /~/auth.json</code>, perk <code>[%auth %del]</code>. This executes <code>++logoff:ya</code> for the cookie session, resolving to <code>++abut</code> to wipe it from memory. </p><h3 id="a-path-not-taken--unsubscription-">A path not taken: unsubscription </h3><p><code>DELETE /~/is/app/path/within</code> works much like <code>PUT /~/is/app/path/within</code>, <code>++del-subs:ix</code> acting as reverse of <code>++add-subs</code> by deleting the duct binding and sending <code>%g %nuke</code>. </p><p>XX unmentioned arms: abet, add-poll, adit, ames-gram, anon, ares-to-json, bolo, cyst, doze, even, ford-kill, get-mean, gift, give-json, give-thou, gram, hapt, hasp, host-to-ship, ix, ixor, js, kiss, load, mean-json, move, note, pass-note, perk, perk-auth, pest, poke-test, print-subs, render-tang, resp, root-beak, scry, ses-authed, ses-ya, sign, silk, sine, stay, stem, teba, titl, to-oryx, urb, wait-era, wake, whir, wush, xml, ya, ye </p><h3 id="appendix-a--dns--a-id----dns------">Appendix A: DNS &lt;a id=“dns”/&gt; </h3><p>The <code>*.urbit.org</code> domain can be used to access destroyers and cruisers. In the common case oh hosted ships, this is done by dynamic DNS directly to the hosting instance. We do not speak of the uncommon case. When ports are blocked and infrastructure crumbles around you, only imported martian networking can be trusted: the <code>%get</code> and <code>%got</code> <a href="">gram</a>s are used to proxy <a href=""><code>%this</code> requests</a> and <a href=""><code>%thou</code> responses</a> respectively. </p><h2><div id="specification">Specification</div></h2><p>The <code>%eyre</code> vane serves one purpose: receiving inbound HTTP requests from browsers and clients pretending to be browsers. To facilitate this communication, <code>%eyre</code> does two things: 1. provide an API for traditional clients to talk to; and 2. provide a mechanism for saving state that allows the server to keep track of identities/sessions, subscription data, and active connections. </p><p>This document outlines the following: </p><p>1. <a href="#perk"><code>perk</code></a>, a <code>pork</code> subset that defines what URLs the client can send to <code>%eyre</code>. </p><p>2. <a href="#client">the values stored on the client</a>, both statically in cookies and dynamically as the <code>window.urb</code> object, which facilitate this transaction. </p><p>3. <a href="#kiss"><code>kiss</code></a>, the requests <code>%eyre</code> will accept. </p><p>4. <a href="#gift"><code>gift</code></a>, the responses it will give to those requests. </p><p>5. <a href="#note"><code>note</code></a>, the set of arvo requests that <code>%eyre</code> makes to the other vanes. </p><p>6. <a href="#whir"><code>whir</code></a>, a <code>wire</code> subset, the associated dynamic state </p><p>7. <a href="#sign"><code>sign</code></a>, the responses <code>%eyre</code> accepts </p><p>8. <a href="#bolo"><code>bolo</code></a>, the state stored between separate events. </p><h2 id="1--url-structure-">1. URL structure </h2><p>There exist several URL forms accepted by <code>%eyre</code>. </p><h3 id="1-1-functional-request-">1.1 Functional request </h3><p>The simplest of them is a static <code>%f</code> functional publish request: </p><pre>  GET /[ship]/[desk]/[case]/path/to/file.[mark]
</pre><p>e.g. </p><pre>  /~pittyp-pittyp/main/5/lib/urb.js
</pre><p>A <code>case</code> of 0 signifies the most recent version. </p><p>If no file extension is provided, the default <code>mark</code> is <code>%urb</code>, which consists of <code>%html</code> injected with an auto-refresh script. </p><p>A shorter form: </p><pre>  /path/to.[mark]
</pre><p>is prepended with the <a href="#prefix">default request path</a>. For example, if <code>%eyre</code> is configured with a root of <code>/&lt;our&gt;/main/0/pub</code>, then <code>/doc/arvo</code> is interpreted as a request for <code>/=main=/pub/doc/arvo.urb</code>. </p><p>Auxiliary paths start with <code>/~/</code>, and provide other functionality, such as: </p><h3 id="1-2-auto-reload-">1.2 Auto-reload </h3><p>When a new version of a page becomes available, it is useful to propagate it to the client. The <code>%f</code> vane manages the particulars, and provides an update token along with all published pages. The <code>/~/on</code> long-polling endpoint makes use of that token, which is a hash of the server-stored dependency set. </p><ul><li><p><code>/~/on/[hash].json</code> retuns <code>true</code> when a page may require updating. </p></li><li><p><code>/~/on/[hash].js</code> is a lightweight script that polls for the above. It is primarily used in error messages. </p></li></ul><a id="auth"></a><h2 id="1-3-authentication-">1.3 Authentication </h2><p>Authenticated requests are accomplished through sessions, tracked with cookies which are set on the first such request. </p><ul><li><p><code>/~/as/[user]/...</code> is an authenticated request to <code>...</code>, where <code>user</code> can be a <code>@p</code> ship, <code>&#39;own&#39;</code>, <code>&#39;any&#39;</code>, or <code>&#39;anon&#39;</code>. </p><ol><li><p><code>&#39;anon&#39;</code> is a randomly-generated per-session submarine, and requires no further authentication. </p></li><li><p><code>&#39;own&#39;</code> represents the serving ship. The short form of <code>/~/as/own/</code> is <code>/~~/</code> </p></li><li><p><code>&#39;any&#39;</code> requires a network ship, chosen with a prompt if unknown. The short form of <code>/~/as/any/</code> is <code>/_/</code> </p></li><li><p>Auth requests are handled in three ways: </p></li><li><p>I. If the session is associated with the <code>ship</code>, serve <code>...</code>, storing the ship as the session&#39;s default ship. For example, <code>/~/as/sivtyv-barnel/main/pub/test.html</code> is an authenticated request of <code>/main/pub/test.html</code> with the identity of <code>~sivtyv-barnel</code>. </p></li><li><p>II. If the session is not associated with the <code>ship</code> in the path, the client is redirected to a login page, where a password can be entered. Successful authentication results in a page refresh to the requested path. </p></li><li><p>III. otherwise, <a href="#foreign">send a message</a> to the claimed ship, and redirect the user to <code>https://[foreign-host]/~/am/[ses]/...#[current-host]&amp;?code=[code]</code> </p></li></ol></li><li><p><code>/~/am/[ses]/...#original-host</code> similarly serves a login page. Upon success, inform the <code>ship</code> of the success and redirect it back to <code>http://[original-host]/~/as/&lt;this-ship&gt;/...</code> </p></li><li><p><code>/~/away.html</code> is a log-out page. </p></li><li><p><code>/~/auth.json</code> returns <code>{ship,oryx,user,auth}</code>: the serving ship, a CSRF token, active user, and all allowed users respectively. </p></li><li><p><code>/~/at/{...}.js</code> is an alternate form of <code>/~/auth.json</code>, which injects a line into the served js file that sets <code>{ship, oryx, user, auth}</code> on the <code>window.urb</code> object. </p></li></ul><p>So far, all the paths specified have been GET requests. Authentication, however, requires sending data. This is also done at the <code>/~/auth.json</code> endpoint. </p><ul><li><p><code>POST {oryx,ship,code} /~/auth.json?PUT</code> is used by the login script to authorize a user, and returns the same result as <code>GET</code>, additionally containing either<code>{ok:true}</code> or <code>{fail:&#39;type&#39;,mess:&quot;Error message&quot;}</code> </p></li><li><p><code>POST {oryx,ship?} /~/auth.json?DELETE</code> revokes authorization. Response as above. </p></li></ul><h3 id="1-4-messaging-">1.4 Messaging </h3><ul><li><p><code>POST {oryx, wire, xyro} /~/to/[app]/[mark].json</code>, where <code>xyro</code> is data that will be converted to the <code>mark</code>. In the simplest case, <code>/~/to/hello/json.json</code> will pass <code>xyro</code> through verbatim, sending <code>[%json xyro]</code> to the <code>++poke</code> arm of app <code>%hello</code>. </p></li><li><p><code>POST {oryx, wire, xyro} /~/to/&lt;ship&gt;/[app]/[mark].json</code> is a foreign message send, as above. </p></li></ul><a id="subs"></a><h3 id="1-5-subscriptions-">1.5 Subscriptions </h3><a id="of-ixor"></a><ul><li><p><code>/~/of/[ixor]</code> is an <code>EventSource</code>: a conceptually infinite file containing a stream of events. By default, it sends a newline every 30 seconds serving to signal that the connection is alive to both the server and IP middleware. </p><ol><li><p><code>/~/of/[ixor]?poll={n}</code> is a long-polling fallback interface. Produces event number <code>{n}</code>, blocking until it occurs. Its contexts can be affected by <code>POST</code> requests with a body of <code>{oryx, wire}</code>, and a query string of <code>PUT</code> or <code>DELETE</code>. They return either <code>{mark}</code>(which may be <code>null</code>), or <a href="#mean-json"><code>{fail, mess}</code></a> </p></li></ol></li><li><p><code>/~/in/[hash].json</code> is a dual to <a href="#on-change"><code>/~/on</code></a>. It binds <code>mod</code> events, which echo the requesting token. </p></li><li><p><code>/~/is/[app]/path/to.[mark]</code> binds <code>rush</code> events, formatted with a first line of <code>[app] /path/to</code>, and the rest containing subscription data. Additionally, <code>mean</code> events formatted similarly may arrive, also converted to the relevant mark. </p></li></ul><a id="temp"></a><h3 id="1-6-ablative-">1.6 Ablative </h3><p>These interfaces will temporarily exist to aid development, and are to be considered unstable. </p><ul><li><p><code>/~/debug/...</code> access normally inaccessible pages. For example, <code>/~/debug/as.html</code> will present the login page, regardless of current session status. </p></li></ul><h2 id="2--client-state--a-id----client------">2. Client state ;a(id “client”); </h2><p>Some information is stored on, and provided to, browser clients </p><h3 id="2-1-cookies-">2.1 Cookies </h3><p>Authenticated users receive a cookie on the domain of <code>*.urbit.org</code>. The cookie contains a client session token, keyed by the serving ship. </p><h3 id="2-2-authentication--a-id----auth-json------">2.2 Authentication ;a(id “auth-json”); </h3><p>It is common(e.g. by the <code>%urb</code> mark) to set window.urb to the contents of <code>/~/auth.json</code>: </p><ul><li><p><code>ship</code> is the serving ship </p></li><li><p><code>oryx</code> is a unique CSRF token that identifies this view, bound to the session cookie </p></li><li><p><code>ixor</code> is a hash of <code>oryx</code>, used as an insecure view identifier </p></li><li><p><code>user</code> is the authenticated/generated ship name </p></li><li><p><code>auth</code> is a list of identities usable by this session </p></li></ul><h3 id="2-3-client-library-">2.3 Client library </h3><p>To this object, <code>/main/lib/urb.js</code> adds helpers: </p><ul><li><p><code>app</code> is an optional app name to send messages to by default </p></li><li><p><code>send({data,mark?=&#39;json&#39;,app?=urb.app,ship?}, cb?)</code> delivers messages </p></li><li><p><code>bind({path,app?=urb.app}, cb)</code> subscribes by path </p></li><li><p><code>drop({path,app?=urb.app}, cb?)</code> pulls the subscription </p></li><li><p><code>util</code> is an object containing methods for converting between JavaScript types and Hoon atom odors. </p></li></ul><h2 id="3--requests--a-id----kiss------">3. Requests ;a(id “kiss”); </h2><h2 id="--born-port--ud---unix-init-"><code>[%born port=@ud]</code>, unix init </h2><p>When the <code>vere</code> process is re/started, a TCP port is bound, HTTP requests on which are the scope of this document. The <code>%born</code> gift informs eyre of this occurrence, which in turn updates <a href="#bolo">its state.</a> </p><p><b>Gifts given in response:</b> none. </p><h2 id="--hiss-p-mark-q-cage---outbound-http-"><code>[%hiss p=mark q=cage]</code>, outbound http </h2><p>Userspace http request, converted by <code>%ford</code> into an actual <code>hiss</code>. </p><p><b>Gifts given in response:</b> a <a href=""><code>%sigh</code></a> </p><h3 id="3-1---this-httq---inbound-http-">3.1 <code>[%this httq]</code>, inbound http </h3><p>The primary <code>%eyre</code> request type comes from the host system, and constitutes an inbound http request. It consists of five parts: </p><p>I. <code>p=[? @if]</code>: a loobean determining whether the request is being made over https, and the client source, an IPv6 address possibly encoding an IPv4 one as <code>.0.0.0.0.0.ffff.wwxx.yyzz</code> </p><p>II. <code>q=meth</code>, an http method </p><p>III. <code>r=@t</code>, the unparsed URL </p><p>IV. <code>s=mess</code>, an associative list of header keys/values </p><p>V. <code>t=(unit octs)</code>, the request body, if any. </p><p>After <code>r</code> is parsed to a <code>purl</code>, the <code>pork</code>(relative path) determines the resource being served. The first step in handling an http request is <a href="#perk">classifying its intent</a>. </p><ul><li><p>A ford request results in a <a href="#boil"><code>%boil</code> note</a>. </p></li><li><p><code>/~/[name].js</code> is generated from <a href="#sink">session</a> or <a href="#stem">view</a> state, and <a href="#mime">served</a> as <code>%js</code>. </p></li><li><p><code>/~/am</code> generates a login page. </p></li><li><p><code>/~/as</code> is resolved further if authenticated, generates a similar login page if the claimed ship is local, and otherwise is saved to <a href="#sink">session state</a> and sends a <a href="#lon">“login” <code>%a</code> message</a> to the foreign ship. </p></li><li><p><code>/~/at</code> and <code>/~/auth.json</code> generate a new <code>oryx</code> and store it in the <a href="#sink">session state</a>. </p></li><li><p><code>/~/in</code> and <code>/~/is</code> affect <a href="#stem">view state</a>, possibly sending subscriptions or unsubscriptions to <code>%f</code> and <code>%g</code> respectively, and are generated from view state. </p></li><li><p><code>/~/on</code> is saved to the <code>bolo</code> by <code>hash</code>, and translated to a <a href="#wasp"><code>%wasp</code> note</a>. </p></li><li><p><code>/~/of</code> fails if the <code>ixor</code> is unknown, and otherwise is stored in the <code>ixor</code>, receiving a partial response and all events after its <a href="#">last-seen header</a>. If it has a <code>poll</code> parameter, the response is full, and only occurs if the body is non-empty. Otherwise the oryx is saved as a <a href="#live">live</a> request in case of cancellation. </p></li><li><p><code>/~/to</code> transforms into a <a href="#mess"><code>%g</code> message</a>. </p></li></ul><p><b>Gifts given in response:</b> a <a href=""><code>%thou</code></a>, or a <a href="#that"><code>%that</code></a> followed by multiple <a href=""><code>%thar</code></a>s. </p><h3 id="3-2---thud-----inbound-close-">3.2 <code>[%thud ~]</code>, inbound close </h3><p>Sent when an unresponded-to request is cancelled. The <a href="#live">live</a> effect of the request is looked up, and </p><ul><li><p><code>%exec</code> ford boil requests are cancelled with <code>[%exec ~]</code> </p></li><li><p><code>%wasp</code> ford deps requests are cancelled with <code>[%wasp |]</code> </p></li><li><p><code>%poll</code> session polls <code>%rest</code> the session heartbeat timeout </p></li></ul><h3 id="3-3---thin-p--ud---delivery-failure-">3.3 <code>[%thin p=@ud]</code>, delivery failure </h3><p>Sent when a partial <a href="#that">response</a> or <a href="#thar">body</a> fails to arrive. Its <code>duct</code> is the same as that of the original request. This is handled by <a href="#wait">waiting</a> for the client to reconnect, and if this not occur, unwinding all subscription state. </p><p><b>Gifts given in response:</b> None. </p><h3 id="3-4---wart-sock--path------inbound-message-">3.4 <code></code>[%wart sock [path *]]<code></code>, inbound message </h3><p>Sometimes, messages are received from other ships. They are expected to take the from of a <a href=""><code>gram</code></a>. </p><p><b>Gifts given in response:</b> <a href="#ack"><code>%nice</code> or <code>%mean</code></a>. </p><h4 id="3-4-1-gram--a-id----gram------">3.4.1 <code>gram</code> &lt;a id=“gram”/&gt; </h4><p>There are three messages of note, all concerning authentication &lt;a id=“foreign”/&gt; </p><ul><li><p><code>[/lon ses]</code> &lt;a id=“lon”/&gt; is a login request, which contains the session wishing to authenticate. </p></li><li><p>if the session is already authorized, a reply of <code>[/aut ses]</code> from (%eyre on) a foreign ship prescribes that the session is henceforth allowed to act on its behalf. All waiting <code>/~/as</code> are resolved as successful. </p></li><li><p>otherwise, <code>[/hat ses hart]</code> contains the ship&#39;s preferred hostname. This can then be used to redirect the client. All waiting <code>/~/as</code> are given <code>307 Redirect</code>s to <code>/~/am</code> on the provided host. </p></li></ul><p><b>Gifts given in response:</b> nice? </p><h2 id="4--responses--a-id----gift------">4. Responses ;a(id “gift”); </h2><h3 id="4-1---nice-------mean-ares---network-acknowledgement--a-id----ack------">4.1 <code>[%nice ~]</code>, <code>[%mean ares]</code>, network acknowledgement ;a(id “ack”); </h3><p>A <code>%nice</code> is given upon receiving an <a href="#gram">ames message</a>, indicating succesful receipt. <code>%mean</code> is currently unused directly, but reserved for error conditions. </p><h2 id="--sigh-p-cage---inbound-http-response-"><code>[%sigh p=cage]</code>, inbound http response </h2><p>An HTTP response gets converted to the requested mark, or <code>%tang</code> in case of error. </p><h3 id="4-2---thou-httr---full-http-response-">4.2 <code>[%thou httr]</code>, full HTTP response </h3><p>Most requests are served with one coherent response, consisting of </p><ul><li><p><code>p=@ud</code>, an HTTP status code </p></li><li><p><code>q=mess</code>, response headers </p></li><li><p><code>r=(unit octs)</code>, an optional body </p></li></ul><h3 id="4-3---that-httr---partial-http-response--a-id----that------">4.3 <code>[%that httr]</code>, partial HTTP response ;a(id “that”); </h3><p><a href="#of-ixor">EventStream responses</a> consist of multiple sequential chunks. Treated as <code>%thou</code>, except the request is kept open. </p><h3 id="4-4---thar--unit-octs----partial-http-body--a-id----thar------">4.4 <code>[%thar (unit octs)]</code>, partial HTTP body ;a(id “thar”); </h3><p>Complementing <code>%that</code>, <code>%thar</code> is a body chunk, containing an event. An empty <code>%thar</code> signals for the connection to be closed. </p><p>Body chunks, besides <code>[1 &#39;\0a&#39;]</code>(a heartbeat newline), are encoded from <code>even</code> events. The stem becomes the <a href="#eventsource"><code>event</code> field</a>, and the content, <code>data</code> lines. </p><h4 id="4-4-1-even--event-types--a-id----even------">4.4.1 <code>even</code>, event types ;a(id “even”); </h4><p>There are three events that a <a href="#subs">client subscription</a> will be given. </p><ul><li><p><code>[%news hash]</code>;a(id “even-news”); is a <code>%f</code> update, and contains the relevant dependency token. </p></li><li><p><code>[%rush [term path] wain]</code> ;a(id “even-rush”); is sourced subscription data. </p></li><li><p><code>[%mean [term path] ares]</code> is a sourced subscription error. </p></li></ul><h2 id="5--vane-requests--a-id----note------">5. Vane requests ;a(id “note”); </h2><h3 id="5-1---a--wont-sock--path---gram---outbound-message-">5.1 <code></code>[%a <code>%wont</code> sock <code>[path *]</code>gram]<code></code>, outbound message </h3><p>The <code>%a</code> interface provides conveyance of <a href="#gram">messages</a> over UDP. </p><p>Signs a <code>%woot</code> upon message arrival. </p><h3 id="5-2---b----wait--rest--time---timeout-set-unset--a-id----wait------">5.2 <code>[%b ?(%wait %rest) time]</code>, timeout set/unset ;a(id “wait”); </h3><p>All open <a href="#of-ixor">subscriptions</a> require a “heartbeat” newline every <code>~s30</code>. When this fails to arrive, a complementary timer is set for <code>~m1</code>, after which the client is considered to have departed. The <code>%b</code> timer interface is used to schedule the next such event, or cancel past scheduled ones when a connection closes. </p><p>Signs a <code>%wake</code> upon timer activation. </p><h3 id="5-3---f--wasp--uvi---dependency-listen--a-id----wasp------">5.3 <code>[%f %wasp @uvI]</code>, dependency listen ;a(id “wasp”); </h3><p>Knowledge of filesystem changes, requested by <code>/~/on</code> and <code>/~/in</code>, is requested the <code>%wasp</code> note. It contains the hash token which identifies a set of dependencies to query. Saved as a (live<a href="#live">live</a>#live] request in case of cancellation when caused by <code>/~/on</code>. </p><p>Signs a <code>%writ</code> upon change. </p><h3 id="5-4---f--exec--unit-silk----functional-transformations-">5.4 <code>[%f %exec (unit silk)]</code>, functional transformations </h3><p>The <code>%f</code> interface converts nouns from one form to another. An empty unit represents cancellation. </p><p>Signs a <code>%made</code> containing the computation result. </p><p>The <code>silk</code>s used are as follows: </p><h3 id="--cast--mime--boil-mark-beam---web-span------file-load-"><code>[%cast %mime %boil mark beam [%web span ~]]</code>, file load </h3><p>The simplest functional request is the construction of a page. Saved as a <a href="#live">live</a> request in case of cancellation. </p><ul><li><p>The <code>mark</code> is the request extension, defaulting to <code>%html</code>. </p></li><li><p>A <code>beam</code>(path in <code>%clay</code>) is decoded from the request path. </p></li><li><p>A <code>/web/&lt;nyp ced quy&gt;</code> virtual path is appended, span-encoding method, auth, and query string. </p></li></ul><h3 id="--cast-mark--done---cage---convert--a-id----done------"><code>[%cast mark %done ~ cage]</code>, convert ;a(id “done”); </h3><p>This is used when communicating with apps, in both directions. </p><ul><li><p>Client messages are encoded as JSON objects, but can contain many different marks. Ones sent to non-<code>json.json</code> endpoints are <code>%cast</code> to he relevant mark, with a <code>cage</code> of <code>[%json p:!&gt;(*json) jon]</code>, prior to being sent onwards to applications with <code>[%g %mess]</code>. </p></li><li><p>Subscription responses also come in arbitrary marks, but are required to be sent as whichever mark an endpoint is subscribed to. They get <code>%cast</code> prior to being sent back as a <code>%that</code> EventSource segment. </p></li></ul><h3 id="5-5--g--app-actions-">5.5 <code>%g</code>, app actions </h3><p>The end goal of many a userspace <code>hymn.hook</code> is to provide UI for a <code>%gall</code> app. To accommodate this, various functionality needs to be interfaced with. </p><h3 id="--mess-hapt-ship-cage---app-message--a-id----mess------"><code>[%mess hapt ship cage]</code>, app message ;a(id “mess”); </h3><p>After a <code>/~/to</code> POST has been received, and possibly converted to the correct mark, it is sent to <code>%g</code> for processing. The <code>hapt</code> is the destination, the <code>ship</code> is the source, the <code>cage</code> is the marked message data. </p><p>Signs a <code>%nice</code> or <code>%mean</code>, in userspace or upon crashing. </p><h3 id="--show-hapt-ship-path---app-subscription--a-id----show------"><code>[%show hapt ship path]</code>, app subscription ;a(id “show”); </h3><p>An <code>/~/is</code> PUT, if not already registered, results in a new subscription. A request for such contains the destination <code>hapt</code>, requesting <code>ship</code>, and app-internal <code>path</code>. </p><p>Signs a <code>%nice</code> on init, <code>%rush</code> on data, and a <code>%mean</code> in subscription termination. </p><h3 id="--took-hapt-ship----rush-confirmation-"><code>[%took hapt ship]</code>, <code>%rush</code> confirmation </h3><p>A <code>%took</code> must be sent to acknowledge the receipt of subscription data, which in this case occurs automatically. </p><p>Causes no signs. </p><h3 id="--nuke-hapt----ship--ship-path-----subscription-cancel-"><code>[%nuke hapt $|(ship [ship path])]</code>, subscription cancel </h3><p>An <code>/~/is</code> DELETE is used to remove a subscription, and is converted straightforwardly to a <code>%nuke</code>. Additionally, when a client disconnects, all of its subscriptions are <code>%nuke</code>d to reflect their expiration. </p><p>Signs an empty <code>%mean</code> for each open subscription that is closed. </p><h2 id="6--in-flight-metadata--a-id----whir------">6. In-flight metadata ;a(id “whir”); </h2><p>Various state can be associated with requests, but not necessarily be returned in responses to them. </p><h3 id="6-1----dropthrough--a-id----wire-drop------">6.1 <code>~</code>, dropthrough ;a(id “wire-drop”); </h3><p>If the response should be sent statelessly further up the duct, the <code>wire</code> is empty. This is used in <code>%f</code> pure functional page generation. </p><h3 id="6-2-----y--n--------stability--a-id----wire-live------">6.2 <code>[?(%y %n) ...]</code>, stability ;a(id “wire-live”); </h3><p>The first element of a <a href="#wait"><code>%b</code> timer</a> path distinguishes between live(%y) and dying(%n) channels. </p><h3 id="6-3--of--ixor---view-">6.3 <code>/of/[ixor]</code>, view </h3><p>Designates which stream to act upon. Present on <code>%b</code> timer cards. </p><h3 id="6-4--on--deps--">6.4 <code>/on/&lt;deps&gt;</code> </h3><p>Present on <code>%f</code> dependency news. Looked up in <a href="#bolo">the state</a> to see if any response is necessary. </p><h3 id="6-5--to--hasp---ship---app--a-id----wire-to------">6.5 <code>/to/&lt;hasp&gt;/&lt;ship&gt;</code>, app ;a(id “wire-to”); </h3><p>Present on <code>%f</code> translations of message marks </p><h3 id="6-6--is--ixor---hasp-path---subscription--a-id----wire-is------">6.6 <code>/is/[ixor]/{hasp path}</code>, subscription ;a(id “wire-is”); </h3><p>Subscription requests. Present on <code>%g</code> subscription requests, and <code>%f</code> translations of <a href="#show"><code>%rush</code> subscription data</a>. </p><h2 id="7--vane-responses--a-id----sign------">7. Vane responses ;a(id “sign”); </h2><p>The goal of requests is to cause some manner of result. Specifically, </p><h3 id="7-1---a--woot-ship-coop---acknowledgement-">7.1 <code>[%a %woot ship coop]</code>, acknowledgement </h3><p>A <a href="#mess">message</a> which has been acknowledged remotely. </p><h3 id="7-2---b--wake-----timer-">7.2 <code>[%b %wake ~]</code>, timer </h3><p>Timer activate. If this is a <code>%y</code> <a href="#wire-live">timer</a>, send a newline to each <code>/~/of/[oryx]</code>; if <code>%n</code> and the <code>oryx</code> still has no listeners, wipe its state/subscriptions. </p><h3 id="7-3---f--news-----dependency-update-">7.3 <code>[%f %news ~]</code>, dependency update </h3><p>This message signifies a <code>hash</code> has changed, and listeners to it should be updated. Results in <a href="#even-news"><code>%news</code> events</a> to concerned streams, and <a href="#thou">full responses</a> to relevant long-polls. </p><h3 id="7-4---f--made--each-bead--list-tank-----compute-result-">7.4 <code>[%f %made (each bead (list tank))]</code>, compute result </h3><p>Further action depends on the <a href="#whir"><code>wire</code></a>. It can: </p><ul><li><p>Be empty, designating direct request data, which is <a href="#mime">served</a> back up the <code>duct</code>. </p></li><li><p>Contain <a href="#wire-to">app and requester identities</a>, which designates an app message has been converted to the correct <code>mark</code>, and can now be <a href="#mess">sent to the app</a> with an empty <code>wire</code>. </p></li><li><p>Contain an <code>oryx</code>, app, and <code>path</code>, designating subscription data. If the subscription is active in the relevant <code>stem</code>, it is acknowledged with a <code>%took</code> and given as a <a href="#even-rush"><code>%rush</code> event</a> to all listeners. Otherwise, the subscription is <code>%nuke</code>d. </p></li></ul><h3 id="7-5--g--applications-">7.5 <code>%g</code>, applications </h3><p>The <code>%g</code> interface sends several responses. </p><h3 id="--nice----and---mean-ares---acknowledgment-"><code>[%nice ~]</code> and <code>[%mean ares]</code>, acknowledgment </h3><p>These are given as a response to <code>%mess</code>, with an empty wire, and <code>%show</code>s, with a <a href="#wire-is">subscription wire</a>. The former is <a href="#mime">served</a> back to the requester(i.e. the remaining duct), and the latter returned to the client. </p><h4 id="7-5---rush-cage---subscription-data-">7.5 <code>[%rush cage]</code>, subscription data </h4><p>A <code>%rush</code> arrives on a <a href="#wire-is">subscription wire</a>, and is then sent <a href="#done">for conversion</a> to the correct mark. An unexpected <code>%rush</code> is <code>%nuke</code>d. </p><h2 id="8--server-state--a-id----bolo------">8. Server state ;a(id “bolo”); </h2><p>There is a quantity of data that persists between events. </p><h3 id="8-1-global-">8.1 Global </h3><ul><li><p><code>path</code> ;a(id “prefix”); the default path which is prepended to relative plain requests. Initialized to <code>/&lt;our&gt;</code>, the serving ship; this interprets the first element of requests as a desk, and injects a <code>case</code> of <code>0</code>. </p></li><li><p><code>(jar ship hart)</code> remembered hostnames in order of preference, made accessible through <code>.^</code> </p><ol><li><p>The default values(for self) are <code>http://&lt;ship&gt;.urbit.org:80</code> if not on a fake network, followed by <code>https://0.0.0.0:[port]</code>. </p></li></ol></li><li><p><code>(jug deps (each duct oryx))</code>, <code>/~/on</code> and <code>/~/in</code> endpoints listening to <code>%c</code> updates. </p></li><li><p><code>(map duct live)</code>, inbound request state </p></li><li><p><code>(map ixor oryx)</code>, open <code>/~/of</code> streams. </p></li><li><p><code>(map oryx stem)</code>, open view state. </p></li><li><p><code>(map hole sink)</code>, session state. </p></li><li><p><code>(map hole ,[ship ?])</code>, foreign session names, along with their origin ships and whether they are authorized to act on our behalf. </p></li></ul><h3 id="8-2-live--per-request-state--a-id----live------">8.2 <code>live</code>, per-request state ;a(id “live”); </h3><p>To honor request cancellations, each unserved request must track which effect it is causing. </p><ol><li><p><code>[%exec whir]</code> if it is a ford data request </p></li><li><p><code>[%wasp (list @uvH)]</code> if it is a ford dependency poll </p></li><li><p><code>[%xeno ship]</code> if this is a proxied request </p></li><li><p><code>[%poll ixor]</code> if this is a session long-poll </p></li></ol><h3 id="8-3-sink--per-session-state--a-id----sink------">8.3 <code>sink</code>, per-session state ;a(id “sink”); </h3><p>Each <code>hole</code> has associated authentication state. </p><ul><li><p><code>priv</code>, a random secret that verifies the session, stored in cookie. </p></li><li><p><code>[ship (set ship)]</code>, the <code>ship</code> a session is acting as and any others it has been authorized with. </p></li><li><p><code>(jug ship ,[path duct])</code>, authentication <code>/~/as</code> requests waiting on foreign ships. </p></li><li><p><code>(set oryx)</code>, views associated with this session. Dual of <code>hole</code> in <code>stem</code>. </p></li></ul><h3 id="8-4-stem--per-view-state--a-id----stem------">8.4 <code>stem</code>, per-view state ;a(id “stem”); </h3><p>Each <code>oryx</code> has active subscription state. </p><ul><li><p><code>hole</code>, session in which this view resides. Dual of <code>(set oryx)</code> in <code>sink</code>. </p></li><li><p><code>ixor</code> ;a(id “ixor”); , a cached hash of the <code>oryx</code> that is used as a subscription id, by the <code>/~/of</code> EventStream. </p></li><li><p><code>[,@u (map ,@u even)]</code>, queued <a href="#even">events</a>. Has a maximum size. </p></li><li><p><code>(unit ,[duct @u ?])</code>, http connection, its last received event, and whether it is a long-poll request. </p></li><li><p><code>(set deps)</code>, subscribed <code>/~/in</code> points. Mirrored in <code>bolo</code>. </p></li><li><p><code>(map ,[hasp path] mark)</code>, subscribed <code>/~/is</code> points </p></li><li><p><code>(que duct)</code>, where any <code>%nice</code>/`%mean </p></li></ul><h2 id="appendix-a--glossary-">Appendix A: Glossary </h2><ul><li><p>An <code>oryx</code> is a CSRF token used for <a href="#auth">authenticated requests</a> </p></li><li><p><code>mean.json</code> ;a(id “mean-json”); is a rendering of hoon <code>ares</code>: an error message formatted as <code>{fail:&#39;type&#39;,mess:&quot;Error message&quot;}</code> </p></li><li><p><code>urb.js</code> ;a(id “urb-js”); is the standard client-side implementation of the <code>%eyre</code> protocols, normally found in <code>/=main=/lib</code> </p></li><li><p>The act of “serving” ;a(id “mime”); , refers to the wrapping of a <code>%mime</code> cage in an HTTP <code>200 Success</code> response, and errors or other marks being <a href="#done">sent to ford</a> for conversion. Inside a <code>sign</code>, this conversion occurs along the same <a href="#wire"><code>wire</code></a>; otherwise, the <code>wire</code> is <a href="#wire-drop">empty</a>. </p></li></ul><h2 id="appendix-b--eventsource--a-id----eventsource------">Appendix B: EventSource ;a(id “eventsource”); </h2><p>UNIMPLEMENTED </p><p>For more information, see &lt;http://dev.w3.org/html5/eventsource/&gt; </p><p>An EventSource is a stream of events, encoded in a conceptually infinite <code>GET</code> request. Each event is formatted as </p><pre>  http
  id: {number}
  event: {type}
  data: {contents}
  data: {more-contents}
</pre><p>Data lines are joined by ASCII <code>10</code> newline characters; multiple newlines signify separate events. The <code>id</code> is used in a <code>Last-Event-ID</code> HTTP request header upon reconnection. </p></div></div></div></div></div><footer class="mb-36"><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script src="/js/main.js"></script></footer></body></html></body></html>